# persistence.nvim - 会话管理

persistence.nvim 是一个会话管理插件，可以自动保存和恢复 Neovim 会话。

## 安装方式

```lua
{
  "folke/persistence.nvim",
  keys = {
    { "<leader>qs", "<cmd>lua require('persistence').load()<cr>", mode = "n", silent = true, desc = "Restore Session" },
    { "<leader>ql", "<cmd>lua require('persistence').load({ last = true })<cr>", mode = "n", silent = true, desc = "Restore Last Session" },
    { "<leader>qd", "<cmd>lua require('persistence').stop()<cr>", mode = "n", silent = true, desc = "Don't Save Current Session" },
  },
}
```

## 快捷键一览表

| 按键 | 作用 | 备注 |
|------|------|------|
| `<leader>qs` | 恢复会话 | 恢复上次保存的会话 |
| `<leader>ql` | 恢复最后会话 | 恢复最后一个会话 |
| `<leader>qd` | 停止保存会话 | 不保存当前会话 |

## 常用命令/用法

1. **恢复会话**：`<leader>qs` 恢复上次保存的会话
2. **恢复最后会话**：`<leader>ql` 恢复最后一个会话
3. **停止保存**：`<leader>qd` 停止自动保存当前会话
4. **自动保存**：退出时自动保存会话
5. **会话管理**：智能的会话保存和恢复

## 主要特性

- **自动保存**：退出时自动保存会话
- **智能恢复**：启动时自动恢复会话
- **会话管理**：支持多个会话
- **可配置**：丰富的配置选项
- **性能优化**：高效的会话处理

## 保存内容

- **缓冲区**：打开的缓冲区
- **当前目录**：工作目录
- **标签页**：标签页状态
- **窗口大小**：窗口尺寸
- **帮助**：帮助窗口状态
- **全局变量**：全局变量状态
- **折叠**：代码折叠状态

## 与现有插件的配合/注意事项

- **与项目插件配合**：基于项目目录保存会话
- **与 Git 集成**：在 Git 仓库中工作
- **性能优化**：使用懒加载，避免影响启动速度
- **兼容性**：与现有插件良好兼容
- **可配置性**：丰富的配置选项

## 配置说明

- **自动保存**：退出时自动保存
- **自动加载**：启动时自动加载
- **忽略文件类型**：可配置忽略的文件类型
- **忽略缓冲区类型**：可配置忽略的缓冲区类型
- **会话目录**：会话文件存储位置

## 故障排查

### 常见报错与解决

1. **会话无法保存**
   - 检查目录权限
   - 确认会话目录存在
   - 查看错误信息：`:messages`

2. **会话无法恢复**
   - 检查会话文件是否存在
   - 确认会话文件格式正确
   - 查看会话加载日志

3. **性能问题**
   - 检查会话文件大小
   - 调整保存频率
   - 限制保存内容
